<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>CoderVN</title>
  <link rel="icon" href="../../../../img/favicon.png">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="../../../../css/bootstrap.min.css">
  <!-- animate CSS -->
  <link rel="stylesheet" href="../../../../css/animate.css">
  <!-- owl carousel CSS -->
  <link rel="stylesheet" href="../../../../css/owl.carousel.min.css">
  <!-- themify CSS -->
  <link rel="stylesheet" href="../../../../css/themify-icons.css">
  <!-- flaticon CSS -->
  <link rel="stylesheet" href="../../../../css/liner_icon.css">
  <link rel="stylesheet" href="../../../../css/search.css">
  <!-- style CSS -->
  <link rel="stylesheet" href="../../../../css/style.css">
  <link rel="stylesheet" href="../../../../css/prism.css">

  <style>
    .banner_iot_bg_1 {
      background-image: url("img/banner_blog/1.jpg");
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
    }

    .banner_iot_bg_2 {
      background-image: url("img/banner_blog/2.svg");
      background-position: center;
      background-repeat: no-repeat;
      background-size: cover;
    }
    .content{
      width: 70%; 
      margin:auto;
    }
  </style>
</head>

<body>
  <!--::header part start::-->
  <header class="main_menu">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-12">
          <nav class="navbar navbar-expand-lg navbar-light">
            <a class="navbar-brand" href="../../index.html"> <img src="../../../../img/logo.png" alt="logo"> </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse main-menu-item justify-content-center" id="navbarSupportedContent">
              <ul class="navbar-nav">
                <li class="nav-item active">
                  <a class="nav-link" href="../../index.html">Trang chủ</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link">Giới thiệu</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link">Chia sẽ</a>
                </li>
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="" id="navbarDropdown" role="button" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false">
                    Khóa học
                  </a>
                  <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item">Lập trình STM32 Nâng cao</a>
                    <a class="dropdown-item">Lập trình App IOT</a>
                    <a class="dropdown-item">Lập trình Web Server</a>
                  </div>
                </li>
              </ul>
            </div>
            <div class="header_social_icon d-none d-sm-block">
              <ul>
                <li>
                  <div id="wrap">
                    <form action="#" autocomplete="on">
                      <input id="search" name="search" type="text" placeholder="Search here"><span
                        class="ti-search"></span>
                    </form>
                  </div>
                </li>
                <li><a href="https://www.facebook.com/iotExpertVN" class="d-none d-lg-block"><i
                      class="ti-facebook"></i></a></li>
              </ul>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </header>
  <!-- Header part end-->

  <!-- feature_post start-->
  <div class="content">
    <h1 style="margin-top: 1rem; font-weight: bold; color: #00B5AD">Xây dựng Dashboard giám sát nhiệt độ</h1>
    <p>Bài này sẽ hướng dẫn tạo một dashboard cơ bản sử dụng C# MVC, lấy dữ liệu từ mqtt</p>
    <p>Trước tiên sẽ tìm hiểu về cách xây dựng 1 web server sử dụng mô hình MVC</p>
    <h2 style="margin-top: 1rem; font-weight: bold;">Tìm hiểu mô hình MVC</h2>
    <img src="image/1.png" />
    <p>MVC là từ viết tắt của ‘Model-View-Controller’. Nó đại diện cho các nhà phát triển kiến ​​trúc
      áp dụng khi xây dựng các ứng dụng. Với kiến ​​trúc MVC, chúng ta xem xét cấu trúc ứng dụng
      liên quan đến cách luồng dữ liệu của ứng dụng của chúng ta hoạt động như thế nào.
    </p>
    <h3 style="margin-top: 1rem;">Chức năng các thành phần</h3>
    <ul style="list-style-type: circle; margin-left: 2rem;">
      <li>Model : là nơi chứa những nghiệp vụ tương tác với dữ liệu hoặc hệ quản trị cơ sở dữ liệu (mysql, mssql… ); nó
        sẽ bao gồm các class/function xử lý nhiều nghiệp vụ như kết nối database, truy vấn dữ liệu, thêm – xóa – sửa dữ
        liệu…</li>
      <li>View : là nới chứa những giao diện như một nút bấm, khung nhập, menu, hình ảnh… nó đảm nhiệm nhiệm vụ hiển thị
        dữ liệu và giúp người dùng tương tác với hệ thống.</li>
      <li>Controller : là nới tiếp nhận những yêu cầu xử lý được gửi từ người dùng, nó sẽ gồm những class/ function xử
        lý nhiều nghiệp vụ logic giúp lấy đúng dữ liệu thông tin cần thiết nhờ các nghiệp vụ lớp Model cung cấp và hiển
        thị dữ liệu đó ra cho người dùng nhờ lớp View.</li>
    </ul>
    <h2 style="margin-top: 2rem; font-weight: bold;">Tạo project mvc trong visual studio</h2>
    <p>Ở đây chúng ta dùng .net framwork trên ngôn ngữ C#
    </p>
    <img src="image/2.png" />
    <img src="image/3.png" />
    <h2 style="margin-top: 2rem; font-weight: bold;">Tải về gói thư viện mqtt trong Nuget Package</h2>
    <p>Chúng ta install thư viện m2mqtt để subscribe dữ liệu từ broker</p>
    <p>Vào Project->Manager Nuget packages... và tìm gói m2mqtt</p>
    <img src="image/4.png" />
    <h2 style="margin-top: 2rem; font-weight: bold;">Import thư viện m2mqtt vào project</h2>
    <pre><code class="lang-csharp">
      using uPLibrary.Networking.M2Mqtt;
      using uPLibrary.Networking.M2Mqtt.Messages;
    </code></pre>
    <h2 style="margin-top: 2rem; font-weight: bold;">Khởi tạo client và chạy thử subscribe</h2>
    <pre><code class="lang-csharp">
      MqttClient client = new MqttClient("broker.hivemq.com", 1883, false, MqttSslProtocols.None, null, null);
      client.MqttMsgPublishReceived += clientReceivedData;

      string clientId = Guid.NewGuid().ToString();
      client.Connect(clientId);

      client.Subscribe(new string[] { "2cfdddc1-651d-4a1b-ac9a-25ae2f016400" }, new byte[] { MqttMsgBase.QOS_LEVEL_AT_LEAST_ONCE });
    </code></pre>
    <h2 style="margin-top: 2rem; font-weight: bold;">Add template vào view</h2>
    <p>Sử dụng các template dashboard free có sẵn trên mạng, ngoài ra cần sử dụng những template chưa bị tối ưu cũng
      như chưa bị tối giản trong code javascript để có thể dễ dàng chỉnh sửa
    </p>
    <p>Có thể sử dụng template <a href="https://startbootstrap.com/themes/sb-admin-2/">Sb-admin-2</a></p>
    <p>Sau khi tải template về cần vào thư mục js để kiểm tra code javascript có thể chỉnh sửa được hay 
      không</p>
    <p>Hình bên phải mô tả code javascript đã được tối ưu, do ngôn ngữ javascript là ngôn ngữ thông dịch, 
      nên toàn bộ file javascript sẽ được tải lên máy người dùng và thực thi trên trình duyệt web. Vì thế
      để web chạy nhanh hơn(load nhanh hơn) thì developer cần phải làm nhẹ nhất các file javascript bằng 
      cách làm tinh gọn các biến sử dụng chỉ thành các ký tự. Vì vậy khá khó để sửa đổi code để tùy chỉnh
      dashboard
    </p>
    <div class="row" style="margin-left: 20px;">
      <img style="display: block;" src="image/8.png" />
      <div style="width: 40px;"></div>
      <img src="image/9.png" />
    </div>
    <h2 style="margin-top: 2rem; font-weight: bold;">Sử dụng ajax để truyền dữ liệu giữa backend - frontend</h2>
    <p>
      AJAX là chữ viết tắt của Asynchronous JavaScript and XML. Đơn giản thì ajax giúp cho việc cập nhật 
      dữ liệu từ server -> trình duyệt người dùng thì không cần phải tải lại trang
    </p>
    <img src="image/10.jpg" />
    <h4>Gửi ajax đến server</h4>
    <p>Trong đó</p>
    <ul style="list-style-type: circle; margin-left: 2rem;">
      <li>url: là đường dẫn đến 1 hàm requestData trong HomeController</li>
      <li>type: có 2 loại GET và POST, GET dùng để lấy dữ liệu hoặc POST dùng để gửi dữ liệu lên server</li>
      <li>data: dữ liệu gửi lên server(chỉ có đối với POST)</li>
      <li>success-error: là 2 hàm callback nhưng chỉ duy nhất 1 hàm được thực hiện, được gọi khi nhận 
        trả về từ server(sẽ gọi callback success) hoặc lỗi/timeout(sẽ gọi callback error). Ở hàm callback
        có thể gán một function đã tạo(như error) hoặc có thể gán một function mới(như success)
      </li>
    </ul>    
    <pre><code class="lang-javascript">
      $.ajax({
        url: "/Home/requestData",
        type: "POST",
        data: JSON.stringify(objTest),
        success: function (result) {
          
        },
        error: errorProcess(errorResult)
    });
    </code></pre>
    <h4>Server tiếp nhận gói tin ajax và phản hồi</h4>
    <p>Trong HomeController tạo function tương ứng với url đã tạo trong ajax, dữ liệu truyền vào
      là dữ liệu từ frontend gửi đến controller.</p>
    <p>Cuối cùng sau khi xử lý dữ liệu sẽ return dữ liệu về phía frontend
    </p>
    <pre><code class="lang-javascript">
      public JsonResult requestData(String temp)
      {
        String result = "{\"Value\": \"" + sensorValueStr + "\"}";
        return Json(result, JsonRequestBehavior.AllowGet);
      }
    </code></pre>
    <h2 style="margin-top: 2rem; font-weight: bold;">Cập nhật chart</h2>
    <img src="image/7.png" />
    <p>Thư viện chart sử dụng canvas để render nên khi thay đổi nội dung trên chart cần phải 
      vẽ lại hết toàn bộ</p>
    <p>Ở backend sẽ gửi result là chuỗi json kèm key là "Value" để chứa giá trị hiện tại cần
      cập nhật lên chart, vì thế bước đầu tiên sẽ chuyển json -> key-value và đẩy dữ liệu đó
      vào mảng dữ liệu dataChart
    </p>
    <p>Tùy theo chart có cần lưu giá trị cũ hay chỉ cần chạy real-time thì ta có thể giới hạn
      số lượng trên mảng dữ liệu
    </p>
    <p>Ngoài ra các thư viện chart thông dụng thường hay kèm các hiệu ứng khi render chỉ phù hợp với các
      chart cố định, không thay đổi dữ liệu. Vì thế cần phải disable animation trong chart đi
    </p>
    <pre><code class="lang-javascript">
      $.ajax({
        url: "/Home/requestData",
        type: "POST",
        data: JSON.stringify(objTest),
        success: function (result) {
            valueJson = JSON.parse(result);
            value = parseInt(valueJson['Value']);
            dataChart.push(value);

            if (dataChart.length > 20) {
                dataChart.shift();
            }

            var ctx = document.getElementById('my-chart').getContext('2d');
            var myChart = new Chart(ctx, {
                type: 'line',
                animation: false,
                data: {                          
                    labels: ['M', 'T', 'W', 'T', 'F', 'S', 'S', 'M', 'T', 'W', 'T', 'F', 'S', 'S', 'M', 'T', 'W', 'T', 'F', 'S'],
                    datasets: [{
                        label: 'apples',
                        data: dataChart,
                        backgroundColor: "rgba(153,255,51,0.6)"
                    }]
                },
                options: {
                    animation: {
                        duration: 0
                    }
                }
            });
            
        },
        error: function (result) {
            console.log(result);
        }
      });
    </code></pre>
    <h2 style="margin-top: 2rem; font-weight: bold;">Đưa dự án lên web server</h2>
    <a href="https://codervn.xyz/iot/dashboard/">Dashboard</a>
    <h4 style="margin-top: 20px;">Publish project c#</h4>
    <p>Chọn vào publish project cần đưa lên server, sau đó nén toàn bộ file thành định dạng .zip</p>
    <img src="image/11.png" />
    <h4 style="margin-top: 20px;">Đưa file publish lên server</h4>
    <p>Vào bảng điều khiển của hosting(nếu lập trình .net thì cần sử dụng hosting window), vào Files
      và trong mục Home directory chọn vào httpdocs. Upload file zip đã nén ở trên lên và giải nén ra
      và hoàn tất việc đưa project lên web server
    </p>
    <img src="image/12.png" />
  </div>
  <div style="height: 3rem;"></div>
  <!-- feature_post end-->

  <!-- footer part start-->
  <footer class="footer-area">
    <div class="container">
      <div class="row">
        <div class="col-xl-4 col-md-4 col-sm-6">
          <div class="single-footer-widget footer_1">
            <h4>About Me</h4>
            <p>Do you want to be even more successful? Learn to love learning and growth.
              The more effort you put into improving your skills, the bigger the payoff
              you will get. Realize that things will be hard at first, but the rewards
              will be worth it.</p>
          </div>
        </div>
        <div class="col-xl-4 col-md-4 col-sm-6">
          <div class="single-footer-widget footer_2">
            <h4>Contact us</h4>
            <div class="contact_info">
              <span class="ti-home"></span>
              <h5>TPHCM, VN</h5>
              <p>Phuong Binh Chieu, Quan Thu Duc, TPHCM</p>
            </div>
            <div class="contact_info">
              <span class="ti-headphone-alt"></span>
              <h5>0300000000</h5>
              <p>Mon to Fri 9am to 6 pm.</p>
            </div>
          </div>
        </div>
        <div class="col-xl-4 col-md-4 col-sm-10">
          <div class="single-footer-widget footer_3">
            <h4>Newsletter</h4>
            <p>Stay updated with our latest trends The more effort you put into
              improving your skills, the bigger the payoff you will get realize that things.</p>
            <form action="#">
              <div class="form-group">
                <div class="input-group mb-3">
                  <input type="text" class="form-control" placeholder='Enter email address'
                    onfocus="this.placeholder = ''" onblur="this.placeholder = 'Enter email address'">
                  <div class="input-group-append">
                    <button class="btn" type="button"><span class="lnr lnr-arrow-right"></span></button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="row align-items-center">
        <div class="col-lg-12">
          <div class="copyright_part_text text-center">
            <p class="footer-text m-0">
              <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
              Copyright &copy;
              <script>document.write(new Date().getFullYear());</script> All rights reserved | <a
                href="https://www.facebook.com/iotExpertVN" target="_blank">CoderVN</a>
              <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            </p>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <!-- footer part end-->

  <!-- jquery plugins here-->
  <!-- jquery -->
  <script src="../../../../js/jquery-1.12.1.min.js"></script>
  <!-- popper js -->
  <script src="../../../../js/popper.min.js"></script>
  <!-- bootstrap js -->
  <script src="../../../../js/bootstrap.min.js"></script>
  <!-- custom js -->
  <script src="../../../../js/custom.js"></script>
  <script src="../../../../js/prism.js"></script>
  <script>
    elem = document.querySelector('.content');
    console.log(elem);
    $(document).ready(function() {

      // Code to be executed
      console.log("Document is ready");
    });

  </script>
</body>

</html>